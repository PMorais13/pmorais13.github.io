import{d as j}from"./chunk-RR53PIHF.js";import{a as E,e as g,f as A}from"./chunk-EBI4RQUP.js";import{E as b,Ja as x,Kc as I,X as d,_ as p,ad as v,da as h,k as _,o as u,p as R}from"./chunk-YKXOHSBZ.js";var r={access_token:"mock_access_token",refresh_token:"mock_refresh_token",role:"admin"};var C=(()=>{class i{constructor(e,t){this.document=e,this.platformId=t,this.documentIsAccessible=v(this.platformId)}static getCookieRegExp(e){let t=e.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+t+"|;\\s*"+t+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),i.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.check(e)){e=encodeURIComponent(e);let o=i.getCookieRegExp(e).exec(this.document.cookie);return o&&o[1]?i.safeDecodeURIComponent(o[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},t=this.document;return t.cookie&&t.cookie!==""&&t.cookie.split(";").forEach(o=>{let[a,c]=o.split("=");e[i.safeDecodeURIComponent(a.replace(/^ /,""))]=i.safeDecodeURIComponent(c)}),e}set(e,t,o,a,c,f,k,U){if(!this.documentIsAccessible)return;if(typeof o=="number"||o instanceof Date||a||c||f||k){let m={expires:o,path:a,domain:c,secure:f,sameSite:k||"Lax",partitioned:U};this.set(e,t,m);return}let l=encodeURIComponent(e)+"="+encodeURIComponent(t)+";",s=o||{};if(s.expires)if(typeof s.expires=="number"){let m=new Date(new Date().getTime()+s.expires*1e3*60*60*24);l+="expires="+m.toUTCString()+";"}else l+="expires="+s.expires.toUTCString()+";";s.path&&(l+="path="+s.path+";"),s.domain&&(l+="domain="+s.domain+";"),s.secure===!1&&s.sameSite==="None"&&(s.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),s.secure&&(l+="secure;"),s.sameSite||(s.sameSite="Lax"),l+="sameSite="+s.sameSite+";",s.partitioned&&(l+="Partitioned;"),this.document.cookie=l}delete(e,t,o,a,c="Lax"){if(!this.documentIsAccessible)return;let f=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:f,path:t,domain:o,secure:a,sameSite:c})}deleteAll(e,t,o,a="Lax"){if(!this.documentIsAccessible)return;let c=this.getAll();for(let f in c)c.hasOwnProperty(f)&&this.delete(f,e,t,o,a)}static{this.\u0275fac=function(t){return new(t||i)(h(I),h(x))}}static{this.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var S=class i{constructor(n,e,t){this.http=n;this.cookies=e;this.router=t;let o=this.cookies.get("user_role");o&&o!=="undefined"&&this.roleSubject.next(o)}API_URL=A();roleSubject=new _(null);role$=this.roleSubject.asObservable();login(n){return g()?(this.cookies.set("access_token",r.access_token),this.cookies.set("refresh_token",r.refresh_token),this.cookies.set("user_role",r.role),this.roleSubject.next(r.role),u(r)):this.http.post(`${this.API_URL}/auth/login`,n).pipe(d(e=>{e.access_token&&this.cookies.set("access_token",e.access_token),e.refresh_token&&this.cookies.set("refresh_token",e.refresh_token),e.role&&(this.cookies.set("user_role",e.role),this.roleSubject.next(e.role))}))}refreshToken(){if(g())return this.cookies.set("access_token",r.access_token),this.cookies.set("refresh_token",r.refresh_token),this.cookies.set("user_role",r.role),this.roleSubject.next(r.role),u(r);let n=this.cookies.get("refresh_token");return!n||n==="undefined"?R(()=>new Error("Invalid refresh token")):this.http.post(`${this.API_URL}/auth/refresh`,{refresh_token:n}).pipe(d(e=>{e.access_token&&this.cookies.set("access_token",e.access_token),e.refresh_token&&this.cookies.set("refresh_token",e.refresh_token),e.role&&(this.cookies.set("user_role",e.role),this.roleSubject.next(e.role))}),b(()=>(this.logout(),u())))}getAccessToken(){return this.cookies.get("access_token")}getRefreshToken(){let n=this.cookies.get("refresh_token");return n==="undefined"?"":n}getRole(){return this.roleSubject.value}logout(){this.cookies.delete("access_token"),this.cookies.delete("refresh_token"),this.cookies.delete("user_role"),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||i)(h(E),h(C),h(j))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{C as a,S as b};
