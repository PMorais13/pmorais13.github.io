import{c as K}from"./chunk-2ULKRMEI.js";import{a as _e}from"./chunk-BMKF2DFF.js";import{c as H,d as F,f as I,g as k}from"./chunk-CS2UOYS6.js";import{d as J}from"./chunk-RR53PIHF.js";import{a as ve,b as xe}from"./chunk-JKKRUTKQ.js";import"./chunk-SGYCFQGT.js";import{a as se}from"./chunk-4BCJUKHO.js";import{a as P}from"./chunk-SVXT45U7.js";import"./chunk-PKTJEQ3B.js";import"./chunk-QAGVWGQC.js";import{b as Q,c as W}from"./chunk-CRFRNBQN.js";import{a as he}from"./chunk-V73ZXADK.js";import{b as ge,c as de}from"./chunk-S27XDV5K.js";import{a as Y,b as Z,f as $,g as ee}from"./chunk-3RTCAAWZ.js";import"./chunk-E7XOTRJ6.js";import"./chunk-EBI4RQUP.js";import{j as te,l as d,n as ne,o as ie,r as oe,u as re,v as ae,w as le,y as me}from"./chunk-KONJ5OEV.js";import"./chunk-DI2HMTWA.js";import"./chunk-6XAAMA5M.js";import"./chunk-IMBPNYJZ.js";import"./chunk-NA4IISU4.js";import{a as fe,c as ue}from"./chunk-5A3YSHED.js";import"./chunk-AZWIA2G5.js";import{Db as c,E as T,Ea as j,Ib as D,K as N,Mb as o,Md as pe,Nb as i,Nd as ce,Ob as h,Pb as y,Qb as E,Sb as B,Tc as X,Ub as b,Vb as g,X as V,_c as U,db as t,dc as G,ec as a,fc as x,gc as s,jb as f,o as O,oa as C,p as R,pa as S,qb as A,qc as m,rc as p,tc as z,wa as q,wb as v}from"./chunk-YKXOHSBZ.js";function Se(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.required")," "))}function be(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.minLength")," "))}function Ie(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.maxLength")," "))}function ye(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.required")," "))}function Ee(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.minLength")," "))}function Le(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.maxLength")," "))}function Me(e,r){if(e&1){let n=B();y(0),o(1,"h2",10),a(2),m(3,"translate"),i(),o(4,"form",11),b("ngSubmit",function(){C(n);let l=g(3);return S(l.onSubmit())}),o(5,"mat-form-field",12)(6,"mat-label"),a(7),m(8,"translate"),i(),h(9,"input",13),v(10,Se,3,3,"mat-error",9)(11,be,3,3,"mat-error",9)(12,Ie,3,3,"mat-error",9),i(),o(13,"mat-form-field",12)(14,"mat-label"),a(15),m(16,"translate"),i(),h(17,"input",14),v(18,ye,3,3,"mat-error",9)(19,Ee,3,3,"mat-error",9)(20,Le,3,3,"mat-error",9),i(),o(21,"button",15),a(22),m(23,"translate"),i()(),o(24,"div",16)(25,"a",17),b("click",function(){C(n);let l=g(3);return S(l.switchTo("forgot"))}),a(26),m(27,"translate"),i()(),E()}if(e&2){let n,_,l,L,M,w,u=g(3);t(2),s(" ",p(3,12,"login.title")," "),t(2),c("formGroup",u.form),t(3),x(p(8,14,"login.login")),t(3),c("ngIf",(n=u.form.get("login"))==null?null:n.hasError("required")),t(),c("ngIf",(_=u.form.get("login"))==null?null:_.hasError("minlength")),t(),c("ngIf",(l=u.form.get("login"))==null?null:l.hasError("maxlength")),t(3),x(p(16,16,"login.password")),t(3),c("ngIf",(L=u.form.get("password"))==null?null:L.hasError("required")),t(),c("ngIf",(M=u.form.get("password"))==null?null:M.hasError("minlength")),t(),c("ngIf",(w=u.form.get("password"))==null?null:w.hasError("maxlength")),t(2),s(" ",p(23,18,"login.submit")," "),t(4),x(p(27,20,"login.forgot"))}}function we(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.required")," "))}function Te(e,r){e&1&&(o(0,"mat-error"),a(1),m(2,"translate"),i()),e&2&&(t(),s(" ",p(2,1,"login.invalidEmail")," "))}function Be(e,r){if(e&1){let n=B();y(0),o(1,"h2",10),a(2),m(3,"translate"),i(),o(4,"form",11),b("ngSubmit",function(){C(n);let l=g(3);return S(l.onRecover())}),o(5,"mat-form-field",12)(6,"mat-label"),a(7),m(8,"translate"),i(),h(9,"input",18),v(10,we,3,3,"mat-error",9)(11,Te,3,3,"mat-error",9),i(),o(12,"button",15),a(13),m(14,"translate"),i()(),o(15,"div",16)(16,"a",17),b("click",function(){C(n);let l=g(3);return S(l.switchTo("login"))}),a(17),m(18,"translate"),i()(),E()}if(e&2){let n,_,l=g(3);t(2),s(" ",p(3,7,"login.recoverTitle")," "),t(2),c("formGroup",l.recoveryForm),t(3),x(p(8,9,"login.identifier")),t(3),c("ngIf",(n=l.recoveryForm.get("identifier"))==null?null:n.hasError("required")),t(),c("ngIf",(_=l.recoveryForm.get("identifier"))==null?null:_.hasError("email")),t(2),s(" ",p(14,11,"login.send")," "),t(4),x(p(18,13,"login.back"))}}function Fe(e,r){if(e&1&&(y(0),o(1,"div",8),v(2,Me,28,22,"ng-container",9)(3,Be,19,15,"ng-container",9),i(),E()),e&2){let n=g(2);t(),c("@formAnimation",n.formState),t(),c("ngIf",n.formState==="login"),t(),c("ngIf",n.formState==="forgot")}}function ke(e,r){e&1&&(o(0,"div",8),h(1,"app-loader"),i())}function Pe(e,r){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3),h(3,"img",4),i(),o(4,"h1",5),a(5),i(),o(6,"mat-card",6),v(7,Fe,4,3,"ng-container",7)(8,ke,2,0,"ng-template",null,0,z),i()()()),e&2){let n,_=G(9),l=g();t(5),x((n=l.tenant())==null?null:n.name),t(2),c("ngIf",!l.isLoading)("ngIfElse",_)}}var Ce=class e{constructor(r,n,_,l,L,M,w){this.fb=r;this.authService=n;this.router=_;this.snackBar=l;this.tenantService=L;this.i18n=M;this.destroyRef=w;this.form=this.fb.group({login:this.fb.nonNullable.control("",[d.required,d.minLength(5),d.maxLength(14)]),password:this.fb.nonNullable.control("",[d.required,d.minLength(6),d.maxLength(14)])}),this.recoveryForm=this.fb.group({identifier:this.fb.nonNullable.control("",[d.required,d.email])})}form;recoveryForm;formState="login";isLoading=!1;tenant=j(null);startAplication=!1;ngOnInit(){if(!this.authService.getRefreshToken()){this.startAplication=!0;return}this.authService.refreshToken().pipe(T(()=>O(null)),P(this.destroyRef)).subscribe(n=>{n&&this.router.navigate(["/"])}),this.tenant.set(this.tenantService.getTenant())}onSubmit(){if(!this.form.valid)return;this.isLoading=!0;let r={identifier:"acme",login:this.form.controls.login.value,password:this.form.controls.password.value};this.authService.login(r).pipe(V(()=>console.log("Tentando login...")),T(n=>(this.snackBar.open(this.i18n.translate.instant("login.invalidCredentials"),this.i18n.translate.instant("manualCheckIn.close"),{duration:3e3,horizontalPosition:"right",verticalPosition:"top"}),R(()=>n))),N(()=>{this.router.navigate(["/"]),console.log("Finalizou tentativa de login"),this.isLoading=!1}),P(this.destroyRef)).subscribe(n=>{console.log("Resposta no subscribe:",n),n?.access_token&&this.router.navigate(["/"])})}onRecover(){this.recoveryForm.valid&&(this.isLoading=!0,setTimeout(()=>{this.isLoading=!1,console.log(this.recoveryForm.value)},2e3))}switchTo(r){this.formState=r}static \u0275fac=function(n){return new(n||e)(f(le),f(K),f(J),f(ve),f(_e),f(se),f(q))};static \u0275cmp=A({type:e,selectors:[["app-login"]],decls:1,vars:1,consts:[["loading",""],[1,"login-container"],[1,"login-container__form"],[1,"login-container__branding"],["src","assets/img/account-menu.png","alt","Logo",1,"login-container__logo"],[1,"login-container__company-name"],[1,"login-container__card"],[4,"ngIf","ngIfElse"],[1,"login-container__form-wrapper"],[4,"ngIf"],[1,"login-container__title"],[1,"login-container__form-fields",3,"ngSubmit","formGroup"],["appearance","fill",1,"login-container__field"],["matInput","","formControlName","login"],["matInput","","type","password","formControlName","password"],["mat-flat-button","","color","primary",1,"login-container__button"],[1,"login-container__forgot-password"],[3,"click"],["matInput","","formControlName","identifier"]],template:function(n,_){n&1&&v(0,Pe,10,3,"div",1),n&2&&D(_.startAplication?0:-1)},dependencies:[U,X,me,oe,te,ne,ie,re,ae,ee,$,Y,Z,de,ge,W,Q,ue,fe,he,xe,ce,pe],styles:[".login-container[_ngcontent-%COMP%]{display:flex;height:100vh;width:100%;background:linear-gradient(135deg,#f0f4ff,#fff)}.login-container__form[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;position:relative}.login-container__branding[_ngcontent-%COMP%]{position:absolute;top:1.5rem;left:1.5rem}.login-container__logo[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover}.login-container__company-name[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:2rem;text-align:center}.login-container__card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:2rem;box-sizing:border-box;overflow:hidden;min-height:300px;position:relative}.login-container__title[_ngcontent-%COMP%]{margin-bottom:1.5rem;text-align:center}.login-container__form-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-container__field[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}.login-container__button[_ngcontent-%COMP%]{width:100%}.login-container__forgot-password[_ngcontent-%COMP%]{text-align:center;margin-top:1rem}.login-container__forgot-password[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:.9rem;color:#3f51b5;text-decoration:none}.login-container__forgot-password[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"],data:{animation:[H("formAnimation",[k("login => forgot",[I({opacity:1,transform:"translateX(0)"}),F("300ms ease",I({opacity:0,transform:"translateX(100%)"}))]),k("forgot => login",[I({opacity:1,transform:"translateX(0)"}),F("300ms ease",I({opacity:0,transform:"translateX(-100%)"}))])])]}})};export{Ce as LoginComponent};
