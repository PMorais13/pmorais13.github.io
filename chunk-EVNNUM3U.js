import{a as oe,b as ae,c as se}from"./chunk-ZRFQVSGX.js";import{e as le}from"./chunk-QPUP5IUO.js";import"./chunk-BVEQJOBM.js";import"./chunk-MTBSRNLK.js";import{a as re}from"./chunk-U65QW7TC.js";import{a as te}from"./chunk-UYE33M3Y.js";import{a as ne}from"./chunk-HFXCUJO7.js";import"./chunk-NG3CUKBE.js";import"./chunk-53D4Q4VK.js";import"./chunk-UOP2MRXY.js";import{a as ee}from"./chunk-BMKF2DFF.js";import"./chunk-JKKRUTKQ.js";import"./chunk-SGYCFQGT.js";import{a as ie}from"./chunk-4BCJUKHO.js";import{a as F}from"./chunk-SVXT45U7.js";import"./chunk-PKTJEQ3B.js";import{b as K,c as W}from"./chunk-CRFRNBQN.js";import"./chunk-GKOWSGTX.js";import"./chunk-E7XOTRJ6.js";import{a as $,e as U,f as J,g as E}from"./chunk-EBI4RQUP.js";import{w as X}from"./chunk-KONJ5OEV.js";import"./chunk-DI2HMTWA.js";import"./chunk-6XAAMA5M.js";import"./chunk-IMBPNYJZ.js";import"./chunk-NA4IISU4.js";import"./chunk-5A3YSHED.js";import"./chunk-AZWIA2G5.js";import{$b as Q,B as M,Cb as V,Db as l,L as w,Mb as c,Md as Y,Nb as s,Nd as Z,Ob as f,Pb as A,Qb as L,Sb as H,Tc as q,Ub as u,Vb as y,_ as T,_b as G,_c as z,a as P,ab as B,ac as N,d as O,da as k,db as a,dc as C,ec as b,gc as I,jb as o,oa as m,pa as d,qb as D,qc as g,rc as _,tc as S,wa as j,wb as v}from"./chunk-YKXOHSBZ.js";var h=class r{constructor(i){this.http=i}API_URL=U()?`${J()}/userProfile`:E("userProfile");getProfile(){return this.http.get(this.API_URL)}updateProfile(i){return U()?this.http.patch(this.API_URL,i):this.http.get(E("userProfile"))}static \u0275fac=function(e){return new(e||r)(k($))};static \u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"})};var me=["avatarInput"];function de(r,i){if(r&1&&(f(0,"img",11),g(1,"translate")),r&2){let e=y();l("src",e.avatarUrl,B),V("alt",_(1,2,"profile.avatarAlt"))}}function ve(r,i){r&1&&f(0,"span",12)}function ue(r,i){if(r&1&&(A(0),f(1,"app-employee-expansion-panels",13),L()),r&2){let e=y();a(),l("panelsConfig",e.panelsConfig)}}function ge(r,i){r&1&&f(0,"app-shimmer",14),r&2&&l("cardsCount",1)}var pe=class r{constructor(i,e,n,t,p,R,_e,he,Pe){this.header=i;this.i18n=e;this.tenantService=n;this.favorites=t;this.fileService=p;this.fb=R;this.userProfileService=_e;this.destroyRef=he;this.panelsBuilder=Pe;let x=this.i18n.translate.instant("profile.title");this.header.setTitle(x),this.favorites.setCurrentItem({icon:"person",name:x,route:"/profile"})}avatarInput;avatarUrl=null;avatarFile=null;isLoading=!0;isDirty=!1;panelsConfig=[];originalProfile;ngOnInit(){let i=this.tenantService.getTenant();i&&(this.avatarUrl=i.avatarUrl),this.userProfileService.getProfile().pipe(w()).subscribe(e=>{this.originalProfile=e;let n=this.panelsBuilder.build(e).filter(t=>t.id!=="access");this.panelsConfig=ae(n,this.fb,!1),M(...this.panelsConfig.map(t=>t.formGroup.valueChanges)).pipe(F(this.destroyRef)).subscribe(()=>{this.isDirty=!0}),this.isLoading=!1}),this.tenantService.onTenantChange().pipe(F(this.destroyRef)).subscribe(e=>{e&&(this.avatarUrl=e.avatarUrl)})}ngOnDestroy(){this.favorites.setCurrentItem(null)}triggerFile(){this.avatarInput.nativeElement.click()}onAvatarSelected(i){return O(this,null,function*(){let e=yield this.fileService.process(i);e&&(this.avatarFile=e.file,this.avatarUrl=e.previewUrl,this.isDirty=!0)})}getChangedValues(i){return Object.keys(i.controls).reduce((e,n)=>{let t=i.get(n);return t?.dirty&&(e[n]=t.value),e},{})}save(){if(!this.originalProfile)return;let i=this.panelsConfig.reduce((e,n)=>{let t=this.getChangedValues(n.formGroup);return Object.keys(t).length&&(e[n.id]=t),e},{});this.avatarUrl&&this.avatarUrl!==this.originalProfile.photo&&(i.photo=this.avatarUrl),Object.keys(i).length!==0&&this.userProfileService.updateProfile(i).subscribe(()=>{this.isDirty=!1,this.originalProfile=P(P({},this.originalProfile),i),this.panelsConfig.forEach(e=>e.formGroup.markAsPristine())})}static \u0275fac=function(e){return new(e||r)(o(te),o(ie),o(ee),o(re),o(le),o(X),o(h),o(j),o(se))};static \u0275cmp=D({type:r,selectors:[["app-profile"]],viewQuery:function(e,n){if(e&1&&G(me,5),e&2){let t;Q(t=N())&&(n.avatarInput=t.first)}},decls:17,vars:11,consts:[["placeholder",""],["avatarInput",""],["loading",""],[1,"profile"],[1,"profile__avatar-section"],[1,"profile__avatar-wrapper"],["class","profile__avatar-image",3,"src",4,"ngIf","ngIfElse"],["type","file","accept","image/*,application/pdf",1,"profile__file-input",3,"change"],["mat-raised-button","","color","primary",1,"profile__avatar-button",3,"click"],[4,"ngIf","ngIfElse"],["mat-raised-button","","color","primary",1,"profile__save-button",3,"click","disabled"],[1,"profile__avatar-image",3,"src"],[1,"profile__avatar-placeholder"],[3,"panelsConfig"],["type","card",3,"cardsCount"]],template:function(e,n){if(e&1){let t=H();c(0,"div",3)(1,"div",4)(2,"div",5),v(3,de,2,4,"img",6)(4,ve,1,0,"ng-template",null,0,S),s(),c(6,"input",7,1),u("change",function(R){return m(t),d(n.onAvatarSelected(R))}),s(),c(8,"button",8),u("click",function(){return m(t),d(n.triggerFile())}),b(9),g(10,"translate"),s()(),v(11,ue,2,1,"ng-container",9),c(12,"button",10),u("click",function(){return m(t),d(n.save())}),b(13),g(14,"translate"),s(),v(15,ge,1,1,"ng-template",null,2,S),s()}if(e&2){let t=C(5),p=C(16);a(3),l("ngIf",n.avatarUrl)("ngIfElse",t),a(6),I(" ",_(10,7,"profile.changeAvatar")," "),a(2),l("ngIf",!n.isLoading)("ngIfElse",p),a(),l("disabled",!n.isDirty),a(),I(" ",_(14,9,"addEmployee.save")," ")}},dependencies:[z,q,W,K,Z,Y,oe,ne],styles:[".profile[_ngcontent-%COMP%]{padding:2rem}.profile__avatar-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:2rem}.profile__avatar-wrapper[_ngcontent-%COMP%]{margin-bottom:1rem}.profile__avatar-placeholder[_ngcontent-%COMP%], .profile__avatar-image[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;display:block}.profile__avatar-placeholder[_ngcontent-%COMP%]{background-color:#ccc}.profile__file-input[_ngcontent-%COMP%]{display:none}.profile__avatar-button[_ngcontent-%COMP%]{margin-top:.5rem}.profile__save-button[_ngcontent-%COMP%]{display:block;margin:2rem auto 0}"]})};export{pe as ProfileComponent};
